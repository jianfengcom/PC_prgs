
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  64;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    server_names_hash_bucket_size 64;

    #access_log  logs/access.log main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    gzip  on;

    upstream US_COSME {
        server 127.0.0.1:8080;
    }
    upstream US_TRY {
        server 127.0.0.1:8080;
    }
    upstream CAIBIAN_ADMIN {
        server 127.0.0.1:9003;
    }
    upstream CAIBIAN_API {
        server 127.0.0.1:9002;
    }
    
    server {
        listen       80;
        server_name  lcosme.pclady.com.cn;
        set $snscontext "http://my.pclady.com.cn";

	#include nginx_http2https.conf;

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

	location ~ ^/caibian/admin {
			
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_ADMIN;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	location /article/ {
	    rewrite ^/article/a/newestList\.html    /article/newestList.do break;
	    rewrite ^/article/list\.html    /articleVO/list.do break;
	    rewrite ^/article/a(\d+)\.html  /article/detail.do?id=$1 break;
	    rewrite ^/article/b(\d+)\.html  /commentPick/detail.do?id=$1 break;
	    rewrite ^/article/c(\d+)\.html  /topic/detail.do?id=$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	location /api/ {
	    rewrite ^/api/(.*)  /$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
        
        location / {
	    rewrite ^/test\.html$    /test.jsp break;
            rewrite ^/$        /index.html;
            rewrite ^/admin/$                    /admin/$query_string? break;
            rewrite ^/index.html$                /index.jsp break;
	    #zjx
	    rewrite ^/tag(/p(\d+)?)?\.html$                           /tag/tag.jsp?pageNo=$2  break;
	    #20190116
	    rewrite ^/products_list/$                                                   /products_list.jsp break;
	    rewrite ^/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/products_list/ permanent;
	    rewrite ^/products_list/(\d+)/$                                                   /products_list.jsp?brandId=$1 break;
	    rewrite ^/products_list/br(\d+)_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/products_list/$1/ permanent;
	    rewrite ^/products_list/(\d+)/(?:bs(\d+))?(?:bi(\d+))?(?:sm(\d+))?(?:ef(\d+))?(?:pb(\d+))?(?:pe(\d+))?(?:or(\d+))?(?:p(\d+))?\.html$             /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8&pageNo=$9 break;
	    rewrite ^/products_list/br(\d+)_(?:bs0|(bs[1-9]\d*))_(?:bi0|(bi[1-9]\d*))_(?:sm0|(sm[1-9]\d*))_(?:ef0|(ef[1-9]\d*))_(?:pb0|(pb[1-9]\d*))_(?:pe0|(pe[1-9]\d*))_(?:or0|(or[1-9]\d*))(?:_(?:p0|(p[1-9]\d*)))?\.html$              http://$host/products_list/$1/$2$3$4$5$6$7$8$9.html permanent;

	    #rewrite ^/products_list\.html$                                                                                 /products_list.jsp break;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html              /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html        /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8&pageNo=$9 break;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html$              http://$host/products_list/br$1_bs$2_bi$3_sm$4_ef$5_pb$6_pe$7_or$8.html permanent;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html$       http://$host/products_list/br$1_bs$2_bi$3_sm$4_ef$5_pb$6_pe$7_or$8_p$9.html permanent;

	    rewrite ^/product_photo_list/(\d+)_p(\d+)\.html$       /storage/imagesIndex.jsp?productId=$1&pageNum=$2 break;  
	    rewrite ^/product_photo/(\d+)_(\d+)_(\d+)\.html$            /storage/imageDetail.jsp?imagesId=$1&productId=$2&commentId=$3 break;
	    rewrite ^/product_photo/large/(\d+)_(\d+)_(\d+)\.html$		/storage/large.jsp?imagesId=$1&productId=$2&commentId=$3 break;
	    rewrite ^/product_photo_add/(\d+).html$ 					/storage/uploadProImage.jsp?productId=$1 break;
            rewrite ^/products_taobao_list/$        	 http://$host/products_list/$query_string? permanent;
	    rewrite ^/products_compare_(\w+)\.html$ /product/compare.jsp?ids=$1 break;
	    rewrite ^/compare_same_(\d+)\.html$     /product/compare_same.jsp?id=$1 break;
            rewrite ^/products_hot\.html$                    /products_hot.jsp break;
            rewrite ^/products_hot/bi(\d+)_sm(\d+).html$     /products_sort_hot.jsp?bid=$1&sid=$2 break;
	    rewrite ^/products_hot/t(\d+)\.html$		/products_sort_hot.jsp?csListId=$1 break;
            rewrite ^/products_hot/(\d+)\.html$              http://$host/products_hot.html permanent;

	    #20190506
	    rewrite ^/products_hot/bi(\d+)_sm(\d+)_brand.html$     /brand/brand_rank.jsp?bid=$1&sid=$2 break;

            rewrite ^/brand_list\.html$                      /brand/brand_list.jsp break;
            rewrite ^/product/(\d+)\.html$                   /product_index.jsp?productId=$1 break;
            rewrite ^/product/(\d+)_(\d+)\.html$             http://$host/product/$1.html permanent;
            rewrite ^/product/(\d+)_(\d+)_(\d+)\.html$       http://$host/product/$1.html permanent;
            rewrite ^/product_info/(\d+)\.html$              http://$host/product/$1.html permanent;
            rewrite ^/pingce/(\d+).html$					 /product/pingce.jsp?productId=$1 break;
	    rewrite ^/pingce/(\d+)_(\d+).html$				 /product/pingce.jsp?productId=$1&p=$2 break;
	    rewrite ^/product_comment_reply/(\d+)\.html$ /comment/detail.jsp?src=comment&id=$1 break;
	    rewrite ^/product_comment_reply/(\d+)_(\d+)\.html$ http://$host/product_comment_reply/$1_p$2.html permanent;
	    rewrite ^/product_comment_reply/(\d+)_p(\d+)\.html$ /comment/detail.jsp?id=$1&pageNo=$2 break;
	    rewrite ^/product_other_reply/(\d+)\.html$ /comment/detail.jsp?src=other&id=$1 break;
	    rewrite ^/product_comment_list/(\d+)\.html$ /comment/list.jsp?productId=$1 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d)\.html$ /product_comment_list/$1_$2_0$30.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2&userType=$3 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d)_(\d+)\.html$ /product_comment_list/$1_$2_0$30_p$4.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)_(\d+)\.html$ /product_comment_list/$1_$2_$3_p$4.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)_p(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2&userType=$3&pageNo=$4 break;
            rewrite ^/user/(\d+)_(\d+)\.html$                  $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_c(\d+)\.html$           $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_f(\d+)\.html$           $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_c(\d+)_(\d+)\.html$     $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_f(\d+)_(\d+)\.html$     $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/share_list\.html$                  /bestItem/best_item_index.jsp;
            rewrite ^/share_list_p(\d+)\.html$            /bestItem/best_item_index.jsp?pageNo=$1;
            rewrite ^/share_list_s(\d+)\.html$            /bestItem/best_item_index.jsp?sortId=$1;
            rewrite ^/share_list_s(\d+)_f(\d+)_p(\d+)\.html$            /bestItem/best_item_index.jsp?sortId=$1&flag=$2&pageNo=$3;
            rewrite ^/share/n(\d+)\.html$                 /bestItem/best_item_detail_end.jsp?topicId=$1;
            rewrite ^/share/(\d+)_p(\d+)\.html$         /bestItem/topic_product_comment.jsp?topicId=$1&pageNo=$2;
            rewrite ^/help\.html$                        /help.jsp;
            rewrite ^/customer\.html$         			 /customer.jsp;
	    rewrite ^/pc/$          /review.jsp break;
	    rewrite ^/pc.html          /review.jsp break;
	    rewrite ^/newproduct\.html$                  /newproduct.jsp;
            rewrite ^/message/$                          $snscontext/suggestin_box/ permanent;
            rewrite ^/message/p(\d+)/$                   $snscontext/suggestin_box/ permanent;
            rewrite ^/daren$                             http://$host/daren/ permanent;
            rewrite ^/daren/$                            /daren/userstar_all.jsp;
            rewrite ^/daren/p(\d+)\.html$                /daren/userstar_all.jsp?pageNo=$1;
	    rewrite ^/daren/product/(\d+)\.html$                /daren/userstar_product.jsp?productId=$1;
	    rewrite ^/daren/product/(\d+)_p(\d+)\.html$          /daren/userstar_product.jsp?productId=$1&pageNo=$2;
            rewrite ^/daren/star$                        http://$host/daren/star/ permanent;
            rewrite ^/daren/star/$                       /daren/daren_share.jsp;
            rewrite ^/daren/star/history$                http://$host/daren/star/history/  permanent;
            rewrite ^/daren/star/history/$               /daren/userstar_list.jsp;
            rewrite ^/daren/star/history/p(\d+)\.html$   /daren/userstar_list.jsp?pageNo=$1;
            rewrite ^/group/(\w+)/$                      /group/group_index.jsp?group=$1;
            rewrite ^/group/(\w+)/index_(\d+).html$      /group/group_index.jsp?group=$1&pageNo=$2;
	    rewrite ^/dianping/br(\d+).html$                           /comment/listByBrandSmallSortEff_new.jsp?brandId=$1 break;
	    rewrite ^/dianping/tg(\d+).html$                           /tag/products_list.jsp?keywordId=$1 break;
	    rewrite ^/dianping/tg(\d+)_p(\d+).html$                           /tag/products_list.jsp?keywordId=$1&pageNo=$2 break;
	    rewrite ^/dianping/br(\d+)_p(\d+)\.html$                    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&pageNo=$2 break;
	    rewrite ^/dianping/br(\d+)_bi(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&bigSortId=$2 break;
	    rewrite ^/dianping/br(\d+)_bi(\d+)_p(\d+)\.html$            					/comment/listByBrandSmallSortEff_new.jsp?brandId=$1&bigSortId=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_p(\d+)\.html$            /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_ef(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&effIds=$2 break;
	    rewrite ^/dianping/br(\d+)_ef(\d+)_p(\d+)\.html$            /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&effIds=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)\.html$           /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_p(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&pageNo=$4 break;  
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6 break;   
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)_p(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6&pageNo=$7  break; 
            rewrite ^/(\w+)/s(\d+)\.html$                /serial_index.jsp?brand=$1&seriesId=$2 break;            
            rewrite ^/(\w+)/s(\d+)_(\d+)\.html$          /serial_index.jsp?brand=$1&seriesId=$2&sort=$3 break;
            rewrite ^/(\w+)/s(\d+)_(\d+)_p(\d+)\.html$          /serial_index.jsp?brand=$1&seriesId=$2&sort=$3&pageNo=$4 break;
            rewrite ^/(\w+)$                             http://$host/$1.html permanent;
            rewrite ^/(\w+)/$                            http://$host/$1.html permanent;
            rewrite ^/(\w+).html$                        /brand/brand_index.jsp?brand=$1 break;
            rewrite ^/(\w+)/bi(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html$      /brand/brand_index.jsp?brand=$1&bigSortId=$2&efficacyId=$3&lowPrice=$4&highPrice=$5&sort=$6&pageNo=$7 break;	    
	    rewrite ^/age/br(\d+).html$             /brand/seoLas.jsp?brandId=$1 break;
            rewrite ^/(\w+)/(\d+)\.html$                       http://$host/$1/ permanent;
            rewrite ^/(\w+)/(\d+)_(\d+)\.html$                 http://$host/$1/ permanent;
            rewrite ^/(\w+)/story\.html$                       /brand/brand_story.jsp?brand=$1 break;
            rewrite ^/(\w+)/refer\.html$                       http://$host/$1/ permanent;
            rewrite ^/(\w+)/refer_(\d+)\.html$                 http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list\.html$                http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list_(\d+)\.html$          http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list_(\d+)_(\d+)\.html$    http://$host/$1/ permanent;
	    #20170524
	    #分类专区页
	    rewrite ^/dianping/zq(\d+)\.html$      /products_sort_zone.jsp?id=$1 break;
	    rewrite ^/cosme/product/(\d+).html$                  /interface/wap/product.jsp?id=$1 break;	
            #proxy_redirect    off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_pass http://US_COSME;
        }
    }
    server {
        listen       80;
        server_name  ltry.pclady.com.cn;

	include nginx_http2https.conf;

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

        location / {        
            index  index.html index.htm;
            
            rewrite ^/$ /trial/index.jsp;
	    rewrite ^/index.html$ /trial/index.jsp break;
	    rewrite ^/(\d+)\.html$ /trial/detail.jsp?id=$1 break;
	    rewrite ^/now$ /trial/activity_trying_list.jsp;
	    rewrite ^/now/(\d+)/$ /trial/activity_trying_list.jsp?pageNo=$1 break;
	    rewrite ^/end$ /trial/activity_end_list.jsp break;
	    rewrite ^/end/(\d+)/$ /trial/activity_end_list.jsp?pageNo=$1 break;
	    rewrite ^/comment/(\d+).html$           /trial/report/otherBrand_activity_report_detail.jsp?id=$1 break;
	    rewrite ^/complete/apply/(\d+)/$ /trial/activity_apply_complete.jsp?activityId=$1 break;
	    rewrite ^/complete/report/(\d+)/$ /trial/report_complete.jsp?activityId=$1 break;
	    rewrite ^/report_list/(\d+)/$            http://$host:81/$1_3.html#tag_3 permanent;
	    rewrite ^/express/$ /trial/activity_express.jsp break;
	    rewrite ^/unsubscribe/([\w\W]+)/$ /trial/unsubscribe.jsp?from=$1 break;
	    rewrite ^/user/(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_0_s(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_0_s(\d+)_p(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_1\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_1_p(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/try/user/$ /interface/sns/sns_try_get_userpage.jsp? break;
	    rewrite ^/try/user/0_s(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=0&status=$1 break;
	    rewrite ^/try/user/0_s(\d+)_p(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=0&status=$1&pageNo=$2 break;
	    rewrite ^/try/user/1\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=1 break;
	    rewrite ^/try/user/1_p(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=1&pageNo=$1 break;
	    rewrite ^/try/xw/(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1 break;
	    rewrite ^/try/xw/(\d+)_0_s(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=0&status=$2 break;
	    rewrite ^/try/xw/(\d+)_0_s(\d+)_p(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=0&status=$2&pageNo=$3 break;
	    rewrite ^/try/xw/(\d+)_1\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=1 break;
	    rewrite ^/try/xw/(\d+)_1_p(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=1&pageNo=$2 break;
	    rewrite ^/report/(\d+)/$ /trial/report.jsp?activityId=$1 break;
	    rewrite ^/report/(\d+)_(\d+)/$        /trial/report.jsp?activityId=$1&productId=$2 break;
	    rewrite ^/appeal/$ /trial/appeal/appeal.jsp break;
	    rewrite ^/customer\.html$ /trial/customer/customer.jsp;
	    rewrite ^/help.html$ /trial/help.jsp;
	    rewrite ^/appeal/(\d+).html              /trial/appeal/appeal_sub.jsp?trialId=$1 break;
	    rewrite ^/otherBrand/(\d+)\.html$       /trial/other_brand_detail.jsp?id=$1 break; 

            #proxy_redirect    off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_set_header   Http-Referer     $http_referer;
            proxy_pass http://US_TRY;
        }
    }

    server {
        listen       80;
        server_name  lg.pclady.com.cn 192.168.30.159;

	include nginx_http2https.conf;

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

	location /cosme/article/ {
	    #WAP
	    rewrite ^/cosme/article/list\.html    /wap/articleVO/list.do break;
	    rewrite ^/cosme/article/more.html	/wap/articleVO/dataMore.do break;
	    rewrite ^/cosme/article/a(\d+)\.html  /wap/article/detail.do?id=$1 break;
	    rewrite ^/cosme/article/b(\d+)\.html  /wap/commentPick/detail.do?id=$1 break;
	    rewrite ^/cosme/article/c(\d+)\.html  /wap/topic/detail.do?id=$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

        location / {
		#zjx
		rewrite ^/cosme/search.html$        /interface/wap/search_product.jsp break;	
		rewrite ^/cosme/interface/wap/product_more.html$              /interface/wap/product_more.jsp     break;
		rewrite ^/cosme/tag.html$                             /interface/wap/tag/tag.jsp break;
		rewrite ^/cosme/interface/wap/tag_more.html$          /interface/wap/tag/tag_more.jsp break;
		#lzt
		rewrite ^/cosme/products_list/search_brand.html           /interface/wap/search_brand.jsp break;
		#20190116
		rewrite ^/cosme/products_list/$							/interface/wap/search_category.jsp break;
		rewrite ^/cosme/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/cosme/products_list/ permanent;
		rewrite ^/cosme/products_list/(\d+)/$                                                   /interface/wap/product_list.jsp?brandId=$1 break;
		rewrite ^/cosme/products_list/br(\d+)_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/cosme/products_list/$1/ permanent;
		rewrite ^/cosme/products_list/(\d+)/(?:bs(\d+))?(?:bi(\d+))?(?:sm(\d+))?(?:ef(\d+))?(?:pb(\d+))?(?:pe(\d+))?(?:or(\d+))?(?:p(\d+))?\.html$             /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
		rewrite ^/cosme/products_list/br(\d+)_(?:bs0|(bs[1-9]\d*))_(?:bi0|(bi[1-9]\d*))_(?:sm0|(sm[1-9]\d*))_(?:ef0|(ef[1-9]\d*))_(?:pb0|(pb[1-9]\d*))_(?:pe0|(pe[1-9]\d*))_(?:or0|(or[1-9]\d*))\.html$              http://$host/cosme/products_list/$1/$2$3$4$5$6$7$8.html permanent;

		#wap
		rewrite ^/cosme/comment/giveawayCommentEdit.jsp$                /interface/wap/commentEdit.jsp break;
		rewrite ^/cosme/age/br(\d+).html                                 /interface/wap/brand_seoLas.jsp?brandId=$1 break;
		rewrite ^/try/report/(\d+)/$ 					/interface/wap/wechat/report_submit.jsp?activityId=$1 break;
		rewrite ^/try/report/(\d+)_(\d+)/$        			/interface/wap/wechat/report_submit.jsp?activityId=$1&productId=$2 break;
		rewrite ^/try/suit_report/(\d+)/$ 					/interface/wap/wechat/suit_report.jsp?activityId=$1 break;
		rewrite ^/try/report/lead/(\d+)/$        			/interface/wap/wechat/suit_report.jsp?activityId=$1;
		#rewrite ^/try/report/(\d+)/$ 					/interface/wap/wechat/report_submit.jsp?activityId=$1 break;
		#rewrite ^/try/report/(\d+)_(\d+)/$ 				/interface/wap/wechat/report_submit.jsp?activityId=$1&productId=$2 break;
		rewrite ^/g.pclady.com.cn/cosme/product/(\d+).html$                  /interface/wap/product.jsp?id=$1 break;
		rewrite ^/g.pclady.com.cn/cosme/product_comment_reply/(\d+).html$    /interface/wap/productCommentReply.jsp?commentId=$1 break;
		rewrite ^/cosme/brand_list.html           /interface/wap/brand_list.jsp break;
		rewrite ^/cosme/$        /interface/wap/index.jsp break;	
		#rewrite  ^/cosme/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$         /interface/wap/search_category.jsp break;
		rewrite  ^/cosme/products_list/gongxiao\.html$         /interface/wap/search_effect.jsp break;
		rewrite ^/cosme/products_hot.html$        /interface/wap/products_hot.jsp break;
		rewrite ^/cosme/(\w+).html$                        /interface/wap/brand_index.jsp?brand=$1 break;
		rewrite ^/cosme/(\w+)/story.html$                    /interface/wap/brand_story.jsp?brand=$1 break;
		rewrite ^/cosme/(\w+)/s(\d+).html$                 /interface/wap/serial_index.jsp?brandDomain=$1&seriesId=$2 break;
		rewrite ^/cosme/product_comment_list/(\d+)\.html$  /interface/wap/product_comment_list.jsp?id=$1 break;
		rewrite ^/cosme/product_comment_list/(\d+)_(\d+)\.html$  /interface/wap/product_comment_list.jsp?id=$1&tagId=$2 break;

		#rewrite ^/cosme/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html         /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
		#rewrite ^/cosme/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html$        /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 permanent;

		rewrite ^/cosme/dianping/tg(\d+).html       /interface/wap/tag/products_list.jsp?keywordId=$1 break;

		rewrite ^/cosme/products_hot/bi(\d+)_sm(\d+).html    /interface/wap/product_sort_hot.jsp?bid=$1&sid=$2 break;
		#20190507 zouzhiwei
		rewrite ^/cosme/products_hot/bi(\d+)_sm(\d+)_brand.html    /interface/wap/brand_rank.jsp?bid=$1&sid=$2 break;
		#wap版特色榜单终端页
		rewrite ^/cosme/products_hot/t(\d+)\.html$      /interface/wap/product_sort_hot.jsp?csListId=$1;

		rewrite ^/cosme/pingce/(\d+).html       /interface/wap/evaluating.jsp?productId=$1 break;
		rewrite ^/cosme/dianping/br(\d+).html       /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1 break;
		rewrite ^/cosme/dianping/br(\d+)_p(\d+)\.html$                      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&pageNo=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_bi(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&bigSortId=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_bi(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&bigSortId=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_ef(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&effIds=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_ef(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&effIds=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)\.html$             /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_p(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&pageNo=$4 break;  
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6 break;   
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)_p(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6&pageNo=$7  break; 
		#wechat
		rewrite ^/try/$                           /interface/wap/wechat/index.jsp break;
		rewrite ^/try/comment/(\d+)\.html$ 	    /interface/wap/wechat/report_index.jsp?id=$1 break;
		rewrite ^/try/report_list/(\d+)\.html$     /interface/wap/wechat/report_list.jsp?id=$1 break;
		rewrite ^/try/report_list/(\d+)_p(\d+)\.html$     /interface/wap/wechat/report_list.jsp?id=$1&productId=$2 break;
		rewrite ^/try/now\.html$                  /interface/wap/wechat/trial_ing.jsp break;
		rewrite ^/try/next\.html$     			  /interface/wap/wechat/trial_pre.jsp break;
		rewrite ^/try/(\d+)\.html$                /interface/wap/wechat/trial_detail.jsp?id=$1 break;
		rewrite ^/try/apply_(\d+)\.html$                /interface/wap/wechat/apply.jsp?id=$1 break;
		rewrite ^/try/apply_(\d+)\.html$                /interface/wap/wechat/apply.jsp?id=$2 break;
		rewrite ^/try/overapply_(\d+)\.html$  /interface/wap/wechat/applyResult.jsp?code=$1 break;
		#rewrite ^/cosme/products_hot\.html$       /interface/wap/wechat/hot_list.jsp break;
		rewrite ^/cosme/products_list.html$       /interface/wap/wechat/hot_detail.jsp break;
		rewrite ^/cosme/product/(\d+).html$      /interface/wap/product.jsp?id=$1 break;
		rewrite ^/cosme/product_comment_reply/(\d+).html    /interface/wap/productCommentReply.jsp?commentId=$1 break;

		rewrite ^/cosme/interface/2014/letters_brands.html                /interface/2014/letters_brands.jsp  break;
		rewrite ^/cosme/interface/wap/product_list_page.html              /interface/wap/product_list_page.jsp  break;
		rewrite ^/cosme/interface/wap/loadMoreBrandProComm.html           /interface/wap/loadMoreBrandProComm.jsp  break;
		rewrite ^/cosme/interface/wap/solr_product_comment.html           /interface/wap/solr_product_comment.jsp  break;
		rewrite ^/cosme/interface/wap/last_comment_list.html              /interface/wap/last_comment_list.jsp     break;
		rewrite ^/cosme/interface/wap/action/_getEvaluatingItem.html      /interface/wap/action/_getEvaluatingItem.jsp     break;

	        #proxy_redirect    off;
	        proxy_set_header   Host             $host;
	        proxy_set_header   X-Real-IP        $remote_addr;
	        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
	        proxy_set_header   Http-Referer     $http_referer;
                proxy_pass http://US_TRY;
        }
    }

    server {
        listen       443 ssl;
	server_name  lcosme.pclady.com.cn;

	ssl_certificate      ../ssl/pconline.crt;
	ssl_certificate_key  ../ssl/pconline.key;

	#ssl_session_cache    shared:SSL:1m;
	ssl_session_timeout  5m;

	ssl_ciphers  HIGH:!aNULL:!MD5;
	ssl_prefer_server_ciphers  on;

        set $snscontext "http://my.pclady.com.cn";

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

	location ~ ^/caibian/admin {
			
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_ADMIN;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	location /article/ {
	    rewrite ^/article/a/newestList\.html    /article/newestList.do break;
	    rewrite ^/article/list\.html    /articleVO/list.do break;
	    rewrite ^/article/a(\d+)\.html  /article/detail.do?id=$1 break;
	    rewrite ^/article/b(\d+)\.html  /commentPick/detail.do?id=$1 break;
	    rewrite ^/article/c(\d+)\.html  /topic/detail.do?id=$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	location /api/ {
	    rewrite ^/api/(.*)  /$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
        
        location / { 	
            rewrite ^/$        /index.html;
            rewrite ^/admin/$                    /admin/$query_string? break;
            rewrite ^/index.html$                /index.jsp break;
	    #zjx
	    rewrite ^/tag(/p(\d+)?)?\.html$                           /tag/tag.jsp?pageNo=$2  break;
	    #20190116
	    rewrite ^/products_list/$                                                   /products_list.jsp break;
	    rewrite ^/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/products_list/ permanent;
	    rewrite ^/products_list/(\d+)/$                                                   /products_list.jsp?brandId=$1 break;
	    rewrite ^/products_list/br(\d+)_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/products_list/$1/ permanent;
	    rewrite ^/products_list/(\d+)/(?:bs(\d+))?(?:bi(\d+))?(?:sm(\d+))?(?:ef(\d+))?(?:pb(\d+))?(?:pe(\d+))?(?:or(\d+))?(?:p(\d+))?\.html$             /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8&pageNo=$9 break;
	    rewrite ^/products_list/br(\d+)_(?:bs0|(bs[1-9]\d*))_(?:bi0|(bi[1-9]\d*))_(?:sm0|(sm[1-9]\d*))_(?:ef0|(ef[1-9]\d*))_(?:pb0|(pb[1-9]\d*))_(?:pe0|(pe[1-9]\d*))_(?:or0|(or[1-9]\d*))(?:_(?:p0|(p[1-9]\d*)))?\.html$              http://$host/products_list/$1/$2$3$4$5$6$7$8$9.html permanent;

            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html              /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html        /products_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8&pageNo=$9 break;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html$              http://$host/products_list/br$1_bs$2_bi$3_sm$4_ef$5_pb$6_pe$7_or$8.html permanent;
            #rewrite ^/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html$       http://$host/products_list/br$1_bs$2_bi$3_sm$4_ef$5_pb$6_pe$7_or$8_p$9.html permanent;

	    rewrite ^/product_photo_list/(\d+)_p(\d+)\.html$       /storage/imagesIndex.jsp?productId=$1&pageNum=$2 break;  
	    rewrite ^/product_photo/(\d+)_(\d+)_(\d+)\.html$            /storage/imageDetail.jsp?imagesId=$1&productId=$2&commentId=$3 break;
	    rewrite ^/product_photo/large/(\d+)_(\d+)_(\d+)\.html$		/storage/large.jsp?imagesId=$1&productId=$2&commentId=$3 break;
	    rewrite ^/product_photo_add/(\d+).html$ 					/storage/uploadProImage.jsp?productId=$1 break;
            rewrite ^/products_taobao_list/$        	 http://$host/products_list/$query_string? permanent;
	    rewrite ^/products_compare_(\w+)\.html$ /product/compare.jsp?ids=$1 break;
	    rewrite ^/compare_same_(\d+)\.html$     /product/compare_same.jsp?id=$1 break;
            rewrite ^/products_hot\.html$                    /products_hot.jsp break;
            rewrite ^/products_hot/bi(\d+)_sm(\d+).html$     /products_sort_hot.jsp?bid=$1&sid=$2 break;
	    rewrite ^/products_hot/t(\d+)\.html$		/products_sort_hot.jsp?csListId=$1 break;
            rewrite ^/products_hot/(\d+)\.html$              http://$host/products_hot.html permanent;

	    #20190506
	    rewrite ^/products_hot/bi(\d+)_sm(\d+)_brand.html$     /brand/brand_rank.jsp?bid=$1&sid=$2 break;

            rewrite ^/brand_list\.html$                      /brand/brand_list.jsp break;
            rewrite ^/product/(\d+)\.html$                   /product_index.jsp?productId=$1 break;
            rewrite ^/product/(\d+)_(\d+)\.html$             http://$host/product/$1.html permanent;
            rewrite ^/product/(\d+)_(\d+)_(\d+)\.html$       http://$host/product/$1.html permanent;
            rewrite ^/product_info/(\d+)\.html$              http://$host/product/$1.html permanent;
            rewrite ^/pingce/(\d+).html$					 /product/pingce.jsp?productId=$1 break;
	    rewrite ^/pingce/(\d+)_(\d+).html$				 /product/pingce.jsp?productId=$1&p=$2 break;
	    rewrite ^/product_comment_reply/(\d+)\.html$ /comment/detail.jsp?src=comment&id=$1 break;
	    rewrite ^/product_comment_reply/(\d+)_(\d+)\.html$ http://$host/product_comment_reply/$1_p$2.html permanent;
	    rewrite ^/product_comment_reply/(\d+)_p(\d+)\.html$ /comment/detail.jsp?id=$1&pageNo=$2 break;
	    rewrite ^/product_other_reply/(\d+)\.html$ /comment/detail.jsp?src=other&id=$1 break;
	    rewrite ^/product_comment_list/(\d+)\.html$ /comment/list.jsp?productId=$1 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d)\.html$ /product_comment_list/$1_$2_0$30.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2&userType=$3 break;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d)_(\d+)\.html$ /product_comment_list/$1_$2_0$30_p$4.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)_(\d+)\.html$ /product_comment_list/$1_$2_$3_p$4.html permanent;
	    rewrite ^/product_comment_list/(\d+)_(\d+)_(\d+)_p(\d+)\.html$ /comment/list.jsp?productId=$1&status=$2&userType=$3&pageNo=$4 break;
            rewrite ^/user/(\d+)_(\d+)\.html$                  $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_c(\d+)\.html$           $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_f(\d+)\.html$           $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_c(\d+)_(\d+)\.html$     $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/user/(\d+)_(\d+)_f(\d+)_(\d+)\.html$     $snscontext/id/$1/cosme/comment/ permanent;
            rewrite ^/share_list\.html$                  /bestItem/best_item_index.jsp;
            rewrite ^/share_list_p(\d+)\.html$            /bestItem/best_item_index.jsp?pageNo=$1;
            rewrite ^/share_list_s(\d+)\.html$            /bestItem/best_item_index.jsp?sortId=$1;
            rewrite ^/share_list_s(\d+)_f(\d+)_p(\d+)\.html$            /bestItem/best_item_index.jsp?sortId=$1&flag=$2&pageNo=$3;
            rewrite ^/share/n(\d+)\.html$                 /bestItem/best_item_detail_end.jsp?topicId=$1;
            rewrite ^/share/(\d+)_p(\d+)\.html$         /bestItem/topic_product_comment.jsp?topicId=$1&pageNo=$2;
            rewrite ^/help\.html$                        /help.jsp;
            rewrite ^/customer\.html$         			 /customer.jsp;
	    rewrite ^/pc/$          /review.jsp break;
	    rewrite ^/pc.html          /review.jsp break;
	    rewrite ^/newproduct\.html$                  /newproduct.jsp;
            rewrite ^/message/$                          $snscontext/suggestin_box/ permanent;
            rewrite ^/message/p(\d+)/$                   $snscontext/suggestin_box/ permanent;
            rewrite ^/daren$                             http://$host/daren/ permanent;
            rewrite ^/daren/$                            /daren/userstar_all.jsp;
            rewrite ^/daren/p(\d+)\.html$                /daren/userstar_all.jsp?pageNo=$1;
	    rewrite ^/daren/product/(\d+)\.html$                /daren/userstar_product.jsp?productId=$1;
	    rewrite ^/daren/product/(\d+)_p(\d+)\.html$          /daren/userstar_product.jsp?productId=$1&pageNo=$2;
            rewrite ^/daren/star$                        http://$host/daren/star/ permanent;
            rewrite ^/daren/star/$                       /daren/daren_share.jsp;
            rewrite ^/daren/star/history$                http://$host/daren/star/history/  permanent;
            rewrite ^/daren/star/history/$               /daren/userstar_list.jsp;
            rewrite ^/daren/star/history/p(\d+)\.html$   /daren/userstar_list.jsp?pageNo=$1;
            rewrite ^/group/(\w+)/$                      /group/group_index.jsp?group=$1;
            rewrite ^/group/(\w+)/index_(\d+).html$      /group/group_index.jsp?group=$1&pageNo=$2;
	    rewrite ^/dianping/br(\d+).html$                           /comment/listByBrandSmallSortEff_new.jsp?brandId=$1 break;
	    rewrite ^/dianping/tg(\d+).html$                           /tag/products_list.jsp?keywordId=$1 break;
	    rewrite ^/dianping/tg(\d+)_p(\d+).html$                           /tag/products_list.jsp?keywordId=$1&pageNo=$2 break;
	    rewrite ^/dianping/br(\d+)_p(\d+)\.html$                    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&pageNo=$2 break;
	    rewrite ^/dianping/br(\d+)_bi(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&bigSortId=$2 break;
	    rewrite ^/dianping/br(\d+)_bi(\d+)_p(\d+)\.html$            					/comment/listByBrandSmallSortEff_new.jsp?brandId=$1&bigSortId=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_p(\d+)\.html$            /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_ef(\d+)\.html$                   /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&effIds=$2 break;
	    rewrite ^/dianping/br(\d+)_ef(\d+)_p(\d+)\.html$            /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&effIds=$2&pageNo=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)\.html$           /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3 break;
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_p(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&pageNo=$4 break;  
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6 break;   
	    rewrite ^/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)_p(\d+)\.html$    /comment/listByBrandSmallSortEff_new.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6&pageNo=$7  break; 
            rewrite ^/(\w+)/s(\d+)\.html$                /serial_index.jsp?brand=$1&seriesId=$2 break;            
            rewrite ^/(\w+)/s(\d+)_(\d+)\.html$          /serial_index.jsp?brand=$1&seriesId=$2&sort=$3 break;
            rewrite ^/(\w+)/s(\d+)_(\d+)_p(\d+)\.html$          /serial_index.jsp?brand=$1&seriesId=$2&sort=$3&pageNo=$4 break;
            rewrite ^/(\w+)$                             http://$host/$1.html permanent;
            rewrite ^/(\w+)/$                            http://$host/$1.html permanent;
            rewrite ^/(\w+).html$                        /brand/brand_index.jsp?brand=$1 break;
            rewrite ^/(\w+)/bi(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)_p(\d+)\.html$      /brand/brand_index.jsp?brand=$1&bigSortId=$2&efficacyId=$3&lowPrice=$4&highPrice=$5&sort=$6&pageNo=$7 break;	    
	    rewrite ^/age/br(\d+).html$             /brand/seoLas.jsp?brandId=$1 break;
            rewrite ^/(\w+)/(\d+)\.html$                       http://$host/$1/ permanent;
            rewrite ^/(\w+)/(\d+)_(\d+)\.html$                 http://$host/$1/ permanent;
            rewrite ^/(\w+)/story\.html$                       /brand/brand_story.jsp?brand=$1 break;
            rewrite ^/(\w+)/refer\.html$                       http://$host/$1/ permanent;
            rewrite ^/(\w+)/refer_(\d+)\.html$                 http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list\.html$                http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list_(\d+)\.html$          http://$host/$1/ permanent;
            rewrite ^/(\w+)/comment_list_(\d+)_(\d+)\.html$    http://$host/$1/ permanent;
	    #20170524
	    #分类专区页
	    rewrite ^/dianping/zq(\d+)\.html$      /products_sort_zone.jsp?id=$1 break;
	    rewrite ^/cosme/product/(\d+).html$                  /interface/wap/product.jsp?id=$1 break;

            #proxy_redirect    off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_pass http://US_COSME;
        }

	location ~ ^/wxsitemap {
	    root /data/static/cosme;
	}
    }

    server {
	listen       443 ssl;
	server_name  ltry.pclady.com.cn;

	ssl_certificate      ../ssl/pconline.crt;
	ssl_certificate_key  ../ssl/pconline.key;

	#ssl_session_cache    shared:SSL:1m;
	ssl_session_timeout  5m;

	ssl_ciphers  HIGH:!aNULL:!MD5;
	ssl_prefer_server_ciphers  on;

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

        location / {        
            index  index.html index.htm;
            
            rewrite ^/$ /trial/index.jsp;
	    rewrite ^/index.html$ /trial/index.jsp break;
	    rewrite ^/(\d+)\.html$ /trial/detail.jsp?id=$1 break;
	    rewrite ^/now$ /trial/activity_trying_list.jsp;
	    rewrite ^/now/(\d+)/$ /trial/activity_trying_list.jsp?pageNo=$1 break;
	    rewrite ^/end$ /trial/activity_end_list.jsp break;
	    rewrite ^/end/(\d+)/$ /trial/activity_end_list.jsp?pageNo=$1 break;
	    rewrite ^/comment/(\d+).html$           /trial/report/otherBrand_activity_report_detail.jsp?id=$1 break;
	    rewrite ^/complete/apply/(\d+)/$ /trial/activity_apply_complete.jsp?activityId=$1 break;
	    rewrite ^/complete/report/(\d+)/$ /trial/report_complete.jsp?activityId=$1 break;
	    rewrite ^/report_list/(\d+)/$            http://$host:81/$1_3.html#tag_3 permanent;
	    rewrite ^/express/$ /trial/activity_express.jsp break;
	    rewrite ^/unsubscribe/([\w\W]+)/$ /trial/unsubscribe.jsp?from=$1 break;
	    rewrite ^/user/(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_0_s(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_0_s(\d+)_p(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_1\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/user/(\d+)_1_p(\d+)\.html$ $snscontext/id/$1/cosme/try/ permanent;
	    rewrite ^/try/user/$ /interface/sns/sns_try_get_userpage.jsp? break;
	    rewrite ^/try/user/0_s(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=0&status=$1 break;
	    rewrite ^/try/user/0_s(\d+)_p(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=0&status=$1&pageNo=$2 break;
	    rewrite ^/try/user/1\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=1 break;
	    rewrite ^/try/user/1_p(\d+)\.html$ /interface/sns/sns_try_get_userpage.jsp?pageType=1&pageNo=$1 break;
	    rewrite ^/try/xw/(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1 break;
	    rewrite ^/try/xw/(\d+)_0_s(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=0&status=$2 break;
	    rewrite ^/try/xw/(\d+)_0_s(\d+)_p(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=0&status=$2&pageNo=$3 break;
	    rewrite ^/try/xw/(\d+)_1\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=1 break;
	    rewrite ^/try/xw/(\d+)_1_p(\d+)\.html$ /interface/sns/sns_xw_try_get_userpage.jsp?user=$1&pageType=1&pageNo=$2 break;
	    rewrite ^/report/(\d+)/$ /trial/report.jsp?activityId=$1 break;
	    rewrite ^/report/(\d+)_(\d+)/$        /trial/report.jsp?activityId=$1&productId=$2 break;
	    rewrite ^/appeal/$ /trial/appeal/appeal.jsp break;
	    rewrite ^/customer\.html$ /trial/customer/customer.jsp;
	    rewrite ^/help.html$ /trial/help.jsp;
	    rewrite ^/appeal/(\d+).html              /trial/appeal/appeal_sub.jsp?trialId=$1 break;
	    rewrite ^/otherBrand/(\d+)\.html$       /trial/other_brand_detail.jsp?id=$1 break; 

            #proxy_redirect    off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_set_header   Http-Referer     $http_referer;
            proxy_pass http://US_TRY;
        }
    }

    server {
	listen       443 ssl;
	server_name  lg.pclady.com.cn 192.168.30.159;

	ssl_certificate      ../ssl/pconline.crt;
	ssl_certificate_key  ../ssl/pconline.key;

	#ssl_session_cache    shared:SSL:1m;
	ssl_session_timeout  5m;

	ssl_ciphers  HIGH:!aNULL:!MD5;
	ssl_prefer_server_ciphers  on;

	location ~ ^/global_ssi/ {
            root /data/public_web/;
        }

	location /cosme/article/ {
	    #WAP
	    rewrite ^/cosme/article/list\.html    /wap/articleVO/list.do break;
	    rewrite ^/cosme/article/more.html	/wap/articleVO/dataMore.do break;
	    rewrite ^/cosme/article/a(\d+)\.html  /wap/article/detail.do?id=$1 break;
	    rewrite ^/cosme/article/b(\d+)\.html  /wap/commentPick/detail.do?id=$1 break;
	    rewrite ^/cosme/article/c(\d+)\.html  /wap/topic/detail.do?id=$1 break;
			
	    ssi on;
	    proxy_next_upstream http_502 http_504 error timeout invalid_header;
	    proxy_pass http://CAIBIAN_API;
	    proxy_redirect off;
	    proxy_set_header Host $host;
	    proxy_set_header X-Real-IP $remote_addr;
	    proxy_connect_timeout 20;
	    proxy_read_timeout 50;
	    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

        location / {
		#zjx
		rewrite ^/cosme/search.html$        /interface/wap/search_product.jsp break;	
		rewrite ^/cosme/interface/wap/product_more.html$              /interface/wap/product_more.jsp     break;
		rewrite ^/cosme/tag.html$                             /interface/wap/tag/tag.jsp break;
		rewrite ^/cosme/interface/wap/tag_more.html$          /interface/wap/tag/tag_more.jsp break;
		#lzt
		rewrite ^/cosme/products_list/search_brand.html           /interface/wap/search_brand.jsp break;
		#20190116
		rewrite ^/cosme/products_list/$							/interface/wap/search_category.jsp break;
		rewrite ^/cosme/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/cosme/products_list/ permanent;
		rewrite ^/cosme/products_list/(\d+)/$                                                   /interface/wap/product_list.jsp?brandId=$1 break;
		rewrite ^/cosme/products_list/br(\d+)_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$              http://$host/cosme/products_list/$1/ permanent;
		rewrite ^/cosme/products_list/(\d+)/(?:bs(\d+))?(?:bi(\d+))?(?:sm(\d+))?(?:ef(\d+))?(?:pb(\d+))?(?:pe(\d+))?(?:or(\d+))?(?:p(\d+))?\.html$             /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
		rewrite ^/cosme/products_list/br(\d+)_(?:bs0|(bs[1-9]\d*))_(?:bi0|(bi[1-9]\d*))_(?:sm0|(sm[1-9]\d*))_(?:ef0|(ef[1-9]\d*))_(?:pb0|(pb[1-9]\d*))_(?:pe0|(pe[1-9]\d*))_(?:or0|(or[1-9]\d*))\.html$              http://$host/cosme/products_list/$1/$2$3$4$5$6$7$8.html permanent;
		#wap
		rewrite ^/cosme/comment/giveawayCommentEdit.jsp$                /interface/wap/commentEdit.jsp break;
		rewrite ^/cosme/age/br(\d+).html                                 /interface/wap/brand_seoLas.jsp?brandId=$1 break;
		rewrite ^/try/report/(\d+)/$ 					/interface/wap/wechat/report_submit.jsp?activityId=$1 break;
		rewrite ^/try/report/(\d+)_(\d+)/$        			/interface/wap/wechat/report_submit.jsp?activityId=$1&productId=$2 break;
		rewrite ^/try/suit_report/(\d+)/$ 					/interface/wap/wechat/suit_report.jsp?activityId=$1 break;
		rewrite ^/try/report/lead/(\d+)/$        			/interface/wap/wechat/suit_report.jsp?activityId=$1;
		rewrite ^/cosme/product/(\d+).html$                  /interface/wap/product.jsp?id=$1 break;
		rewrite ^/cosme/product_comment_reply/(\d+).html$    /interface/wap/productCommentReply.jsp?commentId=$1 break;
		rewrite ^/cosme/brand_list.html                                   /interface/wap/brand_list.jsp break;
		rewrite ^/cosme/$                                                /interface/wap/index.jsp break;	
		rewrite ^/cosme/products_list/br0_bs0_bi0_sm0_ef0_pb0_pe0_or0\.html$         /interface/wap/search_category.jsp break;
		rewrite ^/cosme/products_list/gongxiao\.html$         /interface/wap/search_effect.jsp break;
		rewrite ^/cosme/products_hot.html$        /interface/wap/products_hot.jsp break;
		rewrite ^/cosme/brand_list.html           /interface/wap/brand_list.jsp break;
		rewrite ^/cosme/(\w+).html$                        /interface/wap/brand_index.jsp?brand=$1 break;
		rewrite ^/cosme/(\w+)/story.html$                    /interface/wap/brand_story.jsp?brand=$1 break;
		rewrite ^/cosme/(\w+)/s(\d+).html$                 /interface/wap/serial_index.jsp?brandDomain=$1&seriesId=$2 break;
		rewrite ^/cosme/product_comment_list/(\d+)\.html$  /interface/wap/product_comment_list.jsp?id=$1 break;
		rewrite ^/cosme/product_comment_list/(\d+)_(\d+)\.html$  /interface/wap/product_comment_list.jsp?id=$1&tagId=$2 break;

		rewrite ^/cosme/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html         /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 break;
		#rewrite ^/cosme/products_list/br(\d+)_bs(\d+)_bi(\d+)_sm(\d+)_ef(\d+)_pb(\d+)_pe(\d+)_or(\d+)\.html$        /interface/wap/product_list.jsp?brandId=$1&seriesId=$2&bigSortId=$3&smallSortId=$4&efficacyId=$5&lowPrice=$6&highPrice=$7&sort=$8 permanent;

		rewrite ^/cosme/dianping/tg(\d+).html       /interface/wap/tag/products_list.jsp?keywordId=$1 break;

		rewrite ^/cosme/products_hot/bi(\d+)_sm(\d+).html    /interface/wap/product_sort_hot.jsp?bid=$1&sid=$2 break;
		#20190507 zouzhiwei
		rewrite ^/cosme/products_hot/bi(\d+)_sm(\d+)_brand.html    /interface/wap/brand_rank.jsp?bid=$1&sid=$2 break;
		#wap版特色榜单终端页
		rewrite ^/cosme/products_hot/t(\d+)\.html$      /interface/wap/product_sort_hot.jsp?csListId=$1;

		rewrite ^/cosme/pingce/(\d+).html       /interface/wap/evaluating.jsp?productId=$1 break;
		rewrite ^/cosme/dianping/br(\d+).html       /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1 break;
		rewrite ^/cosme/dianping/br(\d+)_p(\d+)\.html$                      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&pageNo=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_bi(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&bigSortId=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_bi(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&bigSortId=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_ef(\d+)\.html$                     /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&effIds=$2 break;
		rewrite ^/cosme/dianping/br(\d+)_ef(\d+)_p(\d+)\.html$              /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&effIds=$2&pageNo=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)\.html$             /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3 break;
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_p(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&pageNo=$4 break;  
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6 break;   
		rewrite ^/cosme/dianping/br(\d+)_sm(\d+)_ef(\d+)_ag(\d+)_at(\d+)_sk(\d+)_p(\d+)\.html$      /interface/wap/listByBrandSmallSortEff.jsp?brandId=$1&smallSortId=$2&effIds=$3&age=$4&attitude=$5&skin=$6&pageNo=$7  break; 
		#wechat
		rewrite ^/try/$                           /interface/wap/wechat/index.jsp break;
		rewrite ^/try/comment/(\d+)\.html$ 	    /interface/wap/wechat/report_index.jsp?id=$1 break;
		rewrite ^/try/report_list/(\d+)\.html$     /interface/wap/wechat/report_list.jsp?id=$1 break;
		rewrite ^/try/report_list/(\d+)_p(\d+)\.html$     /interface/wap/wechat/report_list.jsp?id=$1&productId=$2 break;
		rewrite ^/try/now\.html$                  /interface/wap/wechat/trial_ing.jsp break;
		rewrite ^/try/next\.html$     			  /interface/wap/wechat/trial_pre.jsp break;
		rewrite ^/try/(\d+)\.html$                /interface/wap/wechat/trial_detail.jsp?id=$1 break;
		rewrite ^/try/apply_(\d+)\.html$                /interface/wap/wechat/apply.jsp?id=$1 break;
		rewrite ^/try/apply_(\d+)\.html$                /interface/wap/wechat/apply.jsp?id=$2 break;
		rewrite ^/try/overapply_(\d+)\.html$  /interface/wap/wechat/applyResult.jsp?code=$1 break;
		rewrite ^/cosme/products_hot\.html$       /interface/wap/wechat/hot_list.jsp break;
		rewrite ^/cosme/products_list.html$       /interface/wap/wechat/hot_detail.jsp break;
		rewrite ^/cosme/product/(\d+).html$      /interface/wap/product.jsp?id=$1 break;
		rewrite ^/cosme/product_comment_reply/(\d+).html    /interface/wap/productCommentReply.jsp?commentId=$1 break;

		rewrite ^/cosme/interface/2014/letters_brands.html                /interface/2014/letters_brands.jsp  break;
		rewrite ^/cosme/interface/wap/product_list_page.html              /interface/wap/product_list_page.jsp  break;
		rewrite ^/cosme/interface/wap/loadMoreBrandProComm.html           /interface/wap/loadMoreBrandProComm.jsp  break;
		rewrite ^/cosme/interface/wap/solr_product_comment.html           /interface/wap/solr_product_comment.jsp  break;
		rewrite ^/cosme/interface/wap/last_comment_list.html              /interface/wap/last_comment_list.jsp     break;
		rewrite ^/cosme/interface/wap/action/_getEvaluatingItem.html      /interface/wap/action/_getEvaluatingItem.jsp     break;

	        #proxy_redirect    off;
	        proxy_set_header   Host             $host;
	        proxy_set_header   X-Real-IP        $remote_addr;
	        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
	        proxy_set_header   Http-Referer     $http_referer;
                proxy_pass http://US_TRY;
        }
    }

}
